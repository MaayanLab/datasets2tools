<!-- Object Cards -->
{% macro display_object_card(object_data, object_type) %}

	{% if object_type == 'canned_analysis' %}
		<div class="col-4 canned-analysis-col">
			<div class="canned-analysis-card">
				<div class="row">
					<div class="col-5 canned-analysis-preview-col">
						<a href="{{ url_for('landing', object_type='canned_analysis', object_identifier=object_data.canned_analysis_accession) }}">
							<img class="canned-analysis-preview-icon" src="{{ object_data.canned_analysis_preview_url }}">
						</a>
					</div>
					<div class="col-7 canned-analysis-info-col">
						<div class="row">
							<div class="col-12 canned-analysis-title-col">
								<a href="{{ url_for('landing', object_type='canned_analysis', object_identifier=object_data.canned_analysis_accession) }}" class="canned-analysis-title">
									{{ object_data.canned_analysis_title }}
								</a>
								<div class="canned-analysis-tool">
								{% if object_data.tools|length == 1%}
									<a href="{{ url_for('landing', object_type='tool', object_identifier=object_data.tools[0].tool_name) }}">{{ object_data.tools[0].tool_name }}</a>
								{% else %}
									<a href="#" tabindex="0" data-toggle="popover" data-placement="bottom" data-trigger="focus" data-html="true" title="Tools"  data-template='<div class="popover canned-analysis-info-popover" role="tooltip"><div class="popover-arrow"></div><h3 class="popover-title"></h3><div class="popover-content"></div></div>' data-content="
										{% for tool in object_data.tools %}
											<div class='row canned-analysis-info-popover-row'>
												<div class='col-12'>
													<a class='canned-analysis-info-popover-link' href='{{ url_for('landing', object_type='tool', object_identifier=tool.tool_name) }}'>
														<img class='canned-analysis-info-popover-icon'src='{{ tool.tool_icon_url }}'>
														<span class='canned-analysis-info-popover-name'>{{ tool.tool_name }}</span>
													</a>
												</div>
											</div>
										{% endfor %}
									">
									{{ object_data.tools|length }} tools</a>
								{% endif %}
								</div>
							</div>
						</div>
						<i class="fa fa-info-circle canned-analysis-info-icon" tabindex="0" data-toggle="popover" data-placement="bottom" data-trigger="focus" data-html="true" title="Datasets" data-template='<div class="popover canned-analysis-info-popover" role="tooltip"><div class="popover-arrow"></div><h3 class="popover-title"></h3><div class="popover-content container-fluid"></div></div>' data-content="
								{% for dataset in object_data.datasets.search_results %}
									<div class='row canned-analysis-info-popover-row'>
										<div class='col-12'>
											<a class='canned-analysis-info-popover-link' href='{{ url_for('landing', object_type='dataset', object_identifier=dataset.dataset_accession) }}'>
												<span class='canned-analysis-info-popover-name'>{{ dataset.dataset_accession }}</span>
											</a>
										</div>
									</div>
								{% endfor %}
								<div class='popover-title'>
									Metadata
								</div>
								{% for key, value in object_data.metadata.iteritems() %}
									<div class='row canned-analysis-info-popover-row'>
										<div class='col-6 canned-analysis-info-popover-metadata-tag'>
											{{ key }}
										</div>
										<div class='col-6 canned-analysis-info-popover-metadata-value'>
											{{ value }}
										</div>
									</div>
								{% endfor %}
						"></i>
					</div> <!-- .canned-analysis-info-col -->
				</div>
			</div>
		</div>
	{% elif object_type == 'dataset' %}
		<div class="col-4 dataset-col">
			<div class="dataset-card">
				<div class="row">
					<div class="col-5 dataset-icon-col">
						<a href="{{ url_for('landing', object_type='dataset', object_identifier=object_data.dataset_accession) }}"><img class="dataset-icon" src="{{ object_data.repository_icon_url }}"></a>
					</div>
					<div class="col-7 dataset-info-col">
						<a class="dataset-accession" href="{{ url_for('landing', object_type='dataset', object_identifier=object_data.dataset_accession) }}">{{ object_data.dataset_accession }}</a>
						<a class="dataset-title" href="{{ url_for('landing', object_type='dataset', object_identifier=object_data.dataset_accession) }}">{{ object_data.dataset_title }}</a>
						<a href="{{ url_for('index', tool_name=tool_name, dataset_accession=object_data.dataset_accession) }}">
						{% if tool_name %}
							<a href="{{ url_for('index', tool_name=tool_name, dataset_accession=object_data.dataset_accession) }}">
						{% else %}
							<a href="{{ url_for('index', dataset_accession=object_data.dataset_accession) }}">
						{% endif %}
							<button class="btn analyze-button">Analyze</button>
						</a>
						<i class="fa fa-info-circle dataset-info-icon" tabindex="0" data-toggle="popover" data-placement="bottom" data-trigger="focus" data-html="true" data-template='<div class="popover dataset-info-popover" role="tooltip"><div class="popover-arrow"></div><h3 class="popover-title"></h3><div class="popover-content"></div></div>' data-content="{{ object_data.dataset_description }}"></i>
					</div>
				</div>
			</div>
		</div>
	{% elif object_type == 'tool' %}
		<div class="col-3 tool-col">
			<div class="tool-card">
				<div class="row">
					<div class="col-6 tool-icon-col">
						<a href="{{ url_for('landing', object_type='tool', object_identifier=object_data.tool_name) }}"><img class="tool-icon" src="{{ object_data.tool_icon_url }}"></a>
					</div>
					<div class="col-6 tool-info-col">
						<a class="tool-name" href="{{ url_for('landing', object_type='tool', object_identifier=object_data.tool_name) }}">{{ object_data.tool_name }}</a>
						<a class="tool-developer" href="{{ url_for('landing', object_type='tool', object_identifier=object_data.tool_name) }}">maayanlab</a>
						{% if dataset_accession %}
							<a href="{{ url_for('index', tool_name=object_data.tool_name, dataset_accession=dataset_accession) }}">
						{% else %}
							<a href="{{ url_for('index', tool_name=object_data.tool_name) }}">
						{% endif %}
							<button class="btn analyze-button">Analyze</button>
						</a>
						<i class="fa fa-info-circle tool-info-icon" tabindex="0" data-toggle="popover" data-placement="bottom" data-trigger="focus" data-html="true" data-template='<div class="popover tool-info-popover" role="tooltip"><div class="popover-arrow"></div><h3 class="popover-title"></h3><div class="popover-content"></div></div>' data-content="{{ object_data.tool_description }}"></i>
					</div>
				</div>
			</div>
		</div>
	{% endif %}

{% endmacro %}

<!-- Search Filters -->
{% macro display_search_filters(search_filters, object_type, page_type) %}

	{% set colsize = 'col-3' if object_type == 'canned_analysis' else 'col-4' %}

	<form class="object-search-form" action="{{ request.path }}">

		<div class="row">
			<div class="col-6">
				<a class="filter-button" data-toggle="collapse" href="#{{object_type}}-search-filters" aria-expanded="false" aria-controls="#{{object_type}}-search-filters">Filters &nbsp&#xf0d7;</a>
			</div>
			{% set offsets = [1,2,3] %}
			<div class="col-6 text-right">
				<span class="search-filter-offset-label"> Pages: </span>
					{% for offset in offsets %}
						<input type="radio" name="offset" id="{{object_type}}-offset-{{offset}}" value="{{offset}}"{{ ' checked' if ((offset)|string() == request.args.get('offset', default='1') and object_type == request.args.get('tab')) or (object_type != request.args.get('tab') and offset==1) else ''}}>
						<label for="{{object_type}}-offset-{{offset}}" class="search-filter-offset">{{offset}}</label>
					{% endfor %}
			</div>
		</div>

		<div id="{{object_type}}-search-filters"  class="info-card collapse search-filter-card">
			<div class="info-card-title">General Filters</div>
			<input type="hidden" name="tab" value="{{ object_type }}">
			<div class="container-fluid">
				<div class="row search-filter-row">
					<div class="{{ colsize }}">
						<div class="object-search-form-label">Search</div>
						<div class="form-inline">
							<input class="form-control" type="text" placeholder="Insert terms..." name="q">
							<button class="btn" type="button">
								<i class="fa fa-search"></i>
							</button>
						</div>
					</div>
					{% for key, values in search_filters.iteritems() %}
						{% if key != 'canned_analysis_metadata' %}
						<div class="{{ colsize }}">
							<div class="object-search-form-label">{{ key.title() }}</div>
							<select data-placeholder="Select..." class="search-filter-dropdown" name="{{ key }}">
								<option></option>
								{% for value in values %}
									<option value="{{ value }}"{{ ' selected' if request.args.get('tab') == object_type and request.args.get(key) == value else '' }}>{{ value }}</option>
								{% endfor %}
							</select>
						</div>
						{% endif %}
					{% endfor %}
				</div>
				{% if object_type == 'canned_analysis' %}
					<div class="info-card-divider">Metadata Filters</div>
					<div class="row search-filter-row">
						{% for key, values in search_filters.canned_analysis_metadata.iteritems() %}
							<div class="col-3">
								<div class="object-search-form-label">{{key.replace('_', ' ').title()}}</div>
								<select data-placeholder="Select..." class="search-filter-dropdown" name="{{ key }}">
									<option></option>
									{% for value in values %}
										<option value="{{ value }}"{{ ' selected' if request.args.get('tab') == object_type and request.args.get(key) == value else '' }}>{{ value }}</option>
									{% endfor %}
								</select>
							</div>
						{% endfor %}
					</div>
				{% endif %}
			</div>
		</div>
	</form>

{% endmacro %}

<!-- Search Results -->
{% macro display_search_results(search_filters, object_list, object_type, page_type) %}

	<div class="row search-results-wrapper">
		<div class="col-12">
			<div class="row search-filter-row">
				<div class="col-12">
					{{ display_search_filters(search_filters, object_type, page_type) }}
				</div>
			</div>
			<div class="row object-card-row">
				{% for object_data in object_list %}
					{{ display_object_card(object_data, object_type) }}
				{% endfor %}
			</div>
			<div class="row search-pages-row">
				<div class="col-12 text-right">
					<span class="search-filter-offset-label"> Pages: </span>
					{% for offset in [1,2,3] %}
						<input type="radio" name="offset" id="{{object_type}}-offset-{{offset}}" value="{{offset}}"{{ ' checked' if ((offset)|string() == request.args.get('offset', default='1') and object_type == request.args.get('tab')) or (object_type != request.args.get('tab') and offset==1) else ''}}>
						<label for="{{object_type}}-offset-{{offset}}" class="search-filter-offset">{{offset}}</label>
					{% endfor %}
				</div>
			</div>
		</div>
	</div>

{% endmacro %}
